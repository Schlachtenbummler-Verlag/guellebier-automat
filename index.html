<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Güllebier-Rezepte-Automat</title>
<style>
  body{background:#000;margin:0;padding:0;font-family:sans-serif}
  .gba{color:#fff;background:#222;padding:18px;border-radius:12px;max-width:680px;margin:40px auto}
  .gba__header{text-align:center}
  .gba__machine{margin:12px 0;text-align:center}
  .gba__reels{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:12px}
  .reel{background:#111;padding:10px;border-radius:8px;display:flex;align-items:center;justify-content:center}
  .symbol{width:90px;height:90px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .symbol img{width:100%;height:100%;object-fit:contain;display:block}
  .symbol svg{width:100%;height:100%;display:block}
  .gba__lever{background:#f8d24a;border:none;padding:8px 16px;font-weight:bold;border-radius:20px;cursor:pointer}
  .gba__result{margin-top:12px;padding:8px;background:#111;border-radius:8px;min-height:50px}
  .badge{
    display:inline-block;margin-left:6px;padding:2px 6px;border-radius:8px;
    font-size:.8rem;background:#FFD700;color:#000;font-weight:bold /* Goldener Thaler */
  }
  .desc{font-size:.85rem;color:#ccc;margin-top:4px}
  .back-btn{margin:30px auto;text-align:center}
  .back-btn button{background:#444;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer}
  .back-btn button:hover{background:#666}

  /* Overlay: Bitte ins Querformat drehen (für Handy im Hochformat) */
  #rotateOverlay{
    position:fixed;inset:0;display:none;z-index:9999;
    background:rgba(0,0,0,.9);color:#FFD700;
    font-size:1.4rem;line-height:1.4;text-align:center;
    align-items:center;justify-content:center
  }
</style>
</head>
<body>
<div id="guellebier-automat" class="gba">
  <div class="gba__header">
    <h2>Güllebier-Rezepte-Automat</h2>
    <p class="gba__sub">Drück den Knopf und erhalte deinen Ernteauftrag!</p>
  </div>

  <div class="gba__machine">
    <div class="gba__reels">
      <div class="reel" data-index="0"><div class="symbol"></div></div>
      <div class="reel" data-index="1"><div class="symbol"></div></div>
      <div class="reel" data-index="2"><div class="symbol"></div></div>
      <div class="reel" data-index="3"><div class="symbol"></div></div>
    </div>
    <button class="gba__lever" id="gbaSpin" type="button">Knopf drücken</button>
  </div>

  <div class="gba__result" id="gbaResult"></div>
</div>

<!-- Zurück-Button -->
<div class="back-btn">
  <button onclick="handleBack()">Zurück</button>
</div>

<!-- Overlay für Hochformat -->
<div id="rotateOverlay">Bitte dreh dein Gerät ins Querformat</div>

<!-- Eigene Sounds -->
<audio id="sndButton" src="assets/snd/button.mp3"></audio>
<audio id="sndRattle" src="assets/snd/dreh.mp3" loop></audio>
<audio id="sndStop" src="assets/snd/anhalten.mp3"></audio>
<audio id="sndResult" src="assets/snd/ergebnis.mp3"></audio>

<script>
function log(msg){ try{ console.log('[Automat]', msg); }catch(e){} }

function handleBack(){
  try { window.close(); } catch(e) {}
  if (document.visibilityState === 'visible') {
    if (history.length > 1) { history.back(); return; }
    if (document.referrer)  { location.href = document.referrer; return; }
  }
  location.href = 'https://schlachtenbummler-verlag.jimdosite.com/neu/';
}

// Overlay-Logik (Handy: Querformat empfohlen)
function checkOrientation(){
  const ov = document.getElementById('rotateOverlay');
  if (!ov) return; // falls Element noch nicht vorhanden
  ov.style.display = (window.innerHeight > window.innerWidth) ? 'flex' : 'none';
}

// Nach DOM-Ladung initialisieren
document.addEventListener('DOMContentLoaded', () => {
  checkOrientation();
  window.addEventListener('resize', checkOrientation);
  window.addEventListener('orientationchange', checkOrientation);
});

document.addEventListener('DOMContentLoaded',()=>{
  // DOM-Refs
  const reels = Array.from(document.querySelectorAll('.reel'));
  const btn   = document.querySelector('#gbaSpin');
  const out   = document.querySelector('#gbaResult');
  const sndButton=document.getElementById('sndButton');
  const sndRattle=document.getElementById('sndRattle');
  const sndStop=document.getElementById('sndStop');
  const sndResult=document.getElementById('sndResult');

  // Farben & Assets
  const COLORS = ['rot','blau','gruen','gelb'];
  const IMG = {
    rot:'assets/img/rot.png',
    blau:'assets/img/blau.png',
    gruen:'assets/img/gruen.png',
    gelb:'assets/img/gelb.png'
  };
  const SVG = {
    rot:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#2b9e45' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#d94a4a' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    blau:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#2c9aa7' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#3a7bd5' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    gruen:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#1f8a4c' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#2ecc71' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    gelb:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#79b92f' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#f5d142' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`
  };

  // Rezepte (35) – Punkte als Ganzzahlen (Thaler)
  const RECIPES = {
    'rot,rot,rot,rot': {name:'Dösselheimer Güllebier',pts:15,desc:'Die braune Seele Saxoniens.'},
    'blau,blau,blau,blau': {name:'Leberknebel Export',pts:15,desc:'Klemmt zuverlässig. Arzt danach konsultieren.'},
    'gruen,gruen,gruen,gruen': {name:'Braune Soße',pts:15,desc:'Zähflüssig, herzhaft, löst Sorgen und Rost.'},
    'gelb,gelb,gelb,gelb': {name:'Flotter Otto Extra Hell',pts:15,desc:'Fließt es erst heraus, bleibst du lieber gleich zuhaus!'},
    'rot,rot,rot,blau': {name:'Klemritzer Nierenquetscher',pts:12,desc:'Massiert die Organe von innen.'},
    'rot,rot,rot,gruen': {name:'Rülpsheimer Starkbier',pts:12,desc:'Schenkt Bass im Bauch.'},
    'rot,rot,rot,gelb': {name:'Lord Villains Glanzparade',pts:12,desc:'Edel und unbestechlich herb.'},
    'blau,blau,blau,rot': {name:'Donnerburger Steißtritt',pts:11,desc:'Treffsicherer Geschmack.'},
    'blau,blau,blau,gruen': {name:'Hassnitzer Kellerbräu',pts:11,desc:'Aus dem ganz dunklen Fass.'},
    'blau,blau,blau,gelb': {name:'Stinkhornsuppe Spezial',pts:11,desc:'Duftet nach Abenteuer, Freiheit und alten Socken.'},
    'gruen,gruen,gruen,rot': {name:'Plärrener Humpentrunk',pts:10,desc:'Groß im Glas, laut im Kopf.'},
    'gruen,gruen,gruen,blau': {name:'Hassburger Urstoff Brühe',pts:10,desc:'So bekömmlich wie eine kleine Pilzvergiftung.'},
    'gruen,gruen,gruen,gelb': {name:'Dreschmarer Magenhieb',pts:10,desc:'Direkt, ehrlich, unvergesslich.'},
    'gelb,gelb,gelb,rot': {name:'Kratziger Abtritt',pts:10,desc:'So männlich wie konservative Ein - Artikler.'},
    'gelb,gelb,gelb,blau': {name:'Ynnors Schnarchtrunk',pts:10,desc:'Wirkt sofort.'},
    'gelb,gelb,gelb,gruen': {name:'Schwitzwasser Abblende',pts:10,desc:'Leicht bekömmliches Dünnbier.'},
    'rot,rot,blau,blau': {name:'Beißburger Hamsterwurf',pts:9,desc:'Zwei Paare, ein Ziel.'},
    'rot,rot,gruen,gruen': {name:'Ningelner Nostalgiker',pts:8,desc:'Schmeckt so gut wie früher, nur besser.'},
    'rot,rot,gelb,gelb': {name:'Stockheimer Knollentrunk',pts:8,desc:'Dick im Glas, jetzt mit noch mehr Fruchtfleisch.'},
    'blau,blau,gruen,gruen': {name:'Feldschorle Spezial',pts:8,desc:'Halb Wiese, halb Wolke.'},
    'blau,blau,gelb,gelb': {name:'Rübensprudel Deluxe',pts:7,desc:'Perlt wie Gerüchte.'},
    'gruen,gruen,gelb,gelb': {name:'Krauttrunk Extra Herb',pts:7,desc:'Kratzig im Abgang.'},
    'rot,rot,blau,gruen': {name:'Kellerleichen - Party - Mix',pts:6,desc:'Für Nächte ohne Erinnerung.'},
    'rot,rot,blau,gelb': {name:'Doppelacker Sud',pts:6,desc:'Zweifeldrig gebraut.'},
    'rot,rot,gruen,gelb': {name:'Feierabend Erntetrunk',pts:6,desc:'Wie nach einer 16 - Stundenschicht.'},
    'blau,blau,rot,gruen': {name:'Feldweg - Knöchelknacks',pts:5,desc:'Holprig, aber zielstrebig.'},
    'blau,blau,rot,gelb': {name:'Ackerbowle',pts:5,desc:'Mit allem drin.'},
    'blau,blau,gruen,gelb': {name:'Lumpas goldene Brause - Edel',pts:5,desc:'Kurz und kräftig.'},
    'gruen,gruen,rot,blau': {name:'Hopfenrübe Hell',pts:4,desc:'Leichtfüßig.'},
    'gruen,gruen,rot,gelb': {name:'Ackerschorle',pts:4,desc:'Halb Arbeit, halb Pause.'},
    'gruen,gruen,blau,gelb': {name:'Gärtnerpils',pts:4,desc:'Blüht im Glas.'},
    'gelb,gelb,rot,blau': {name:'Lästerhainer Jodelsprudel',pts:3,desc:'Nach zwei Schlucken singst du.'},
    'gelb,gelb,rot,gruen': {name:'Knollentrunk Spezial',pts:3,desc:'Rund im Mund.'},
    'gelb,gelb,blau,gruen': {name:'Hamstersud',pts:3,desc:'Pelzig auf der Zunge, schnell im Abgang.'},
    'rot,blau,gruen,gelb': {name:'Querbeet',pts:1,desc:'Von allem ein bisschen.'}
  };

  const RECIPES_INDEX={};
  Object.keys(RECIPES).forEach(k=>{
    RECIPES_INDEX[k.split(',').sort().join(',')] = RECIPES[k];
  });

  function normalize(combo){ return combo.slice().sort().join(','); }
  function evaluate(result){
    const key=normalize(result);
    const recipe=RECIPES_INDEX[key]||{name:'Krautwasser',pts:0,desc:'Schmeckt nach nix.'};
    out.innerHTML=`<div class="name">${recipe.name} <span class="badge">+${recipe.pts} Thaler</span></div><div class="desc">${recipe.desc||''}</div>`;
    try{ sndResult.currentTime=0; sndResult.play(); }catch(e){}
  }

  function randomColor(){ return COLORS[Math.floor(Math.random()*COLORS.length)]; }
  function setSymbol(reelEl,color){
    const sym=reelEl.querySelector('.symbol');
    sym.className='symbol '+color;
    const img=new Image();
    img.decoding='async';
    img.alt=color+"e Rübe";
    img.onload=()=>{ sym.innerHTML=''; sym.appendChild(img); };
    img.onerror=()=>{ sym.innerHTML=SVG[color]; };
    img.src=IMG[color];
  }

  // Startanzeige
  reels.forEach(reel=> setSymbol(reel, randomColor()));

  function spin(){
    btn.disabled=true; out.textContent='...suche Rezept für Ernteauftrag...';
    try{ sndButton.currentTime=0; sndButton.play(); }catch(e){}
    try{ sndRattle.currentTime=0; sndRattle.play(); }catch(e){}
    const finals=[];
    reels.forEach((reel,i)=>{
      let delay=1200+i*800;
      const t=setInterval(()=> setSymbol(reel, randomColor()),150);
      setTimeout(()=>{
        clearInterval(t);
        const c=randomColor();
        setSymbol(reel,c);
        finals[i]=c;
        try{ sndStop.currentTime=0; sndStop.play(); }catch(e){}
        if(i===reels.length-1){
          try{ sndRattle.pause(); }catch(e){}
          btn.disabled=false;
          evaluate(finals);
        }
      },delay);
    });
  }

  if(btn){ btn.addEventListener('click', spin); }

  // Orientation-Overlay aktivieren
  checkOrientation();
  window.addEventListener('resize',checkOrientation);
  window.addEventListener('orientationchange',checkOrientation);
});
</script>
</body>
</html>
