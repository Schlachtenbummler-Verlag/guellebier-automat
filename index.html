<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saxonischer Güllebier-Rezepte-Automatron</title>
<style>
  :root{
    /* Walzengröße passt sich an: min 72px, ideal ~20% Viewportbreite, max 150px */
    --reel: clamp(72px, 20vw, 150px);
  }

  /* Scrollbar & Layout stabil halten (kein Seiten-Bump) */
  html{ scrollbar-gutter: stable both-edges; }
  body{ 
    background:#000; margin:0; padding:0; font-family:sans-serif; color:#fff; 
    overflow-y:scroll; text-align:center;
  }

  /* Holzrahmen-Wrapper */
  .frame-wood{
    --frame: clamp(16px, 3.2vw, 44px);
    display: inline-block;              /* nur so breit wie der Inhalt */
    margin: 24px auto;                  /* zentriert, etwas kompakter mobil */
    padding: var(--frame);
    border: var(--frame) solid transparent;
    border-image-source: url('assets/img/wood.svg');
    border-image-slice: 140;
    border-image-width: var(--frame);
    border-image-repeat: round;
    border-radius: 16px;
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
    position:relative;
    max-width: 98vw;                    /* Schutz gegen horizontales Überlaufen */
  }
  .frame-wood::before{
    content:"";
    position:absolute; inset: calc(var(--frame) - 1px);
    border-radius: 12px;
    box-shadow: inset 0 6px 14px rgba(0,0,0,.35), inset 0 -4px 8px rgba(0,0,0,.25);
    pointer-events:none;
  }

  /* Automat (breitenstabil & responsive) */
  .gba{
    color:#fff; background:#222; padding:18px; border-radius:12px;
    width: min(680px, 96vw);            /* nutzt fast die gesamte Breite mobil */
    max-width:680px;
    box-sizing: border-box;
  }
  .gba__header{text-align:center}

  /* Maschine: Reels (oben), Button (mitte), Ergebnis (unten) */
  .gba__machine{
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    align-items:center;
    margin:12px 0;
    text-align:center;
    min-height:min(360px, 70vh);        /* auf kleinen Screens nicht höher als 70% Höhe */
  }

  /* Reels-Grid bleibt */
.gba__reels{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:10px;
  margin-bottom:0;
  width:100%;
  box-sizing:border-box;
}

/* Reel-Kacheln */
.reel{
  background:#111;
  padding:10px;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Symbol füllt die Zellbreite, bleibt aber quadratisch */
.symbol{
  width:100%;
  aspect-ratio: 1 / 1;        /* macht’s quadratisch */
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

/* Bilder/SVGs passen sich sauber ein */
.symbol img,
.symbol svg{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

  .gba__action{text-align:center; margin: 8px 0;}
  .gba__lever{
    background:#f8d24a; border:none; padding:10px 18px; font-weight:bold;
    border-radius:20px; cursor:pointer;
  }

 /* Ergebnis-Container */
.gba__result{
  margin-top:0;
  width:100%;
  display:flex; 
  flex-direction:column;
  justify-content:center; 
  align-items:flex-start;   /* Standard: links */
  text-align:left; 
  gap:6px;
  padding:8px; 
  background:#111; 
  border-radius:8px; 
  min-height:96px;
}

/* Zusatz: zentrierte Ladeanzeige */
.gba__result.loading{
  align-items:center;      /* zentriert horizontal */
  text-align:center;       /* Text mittig */
  color:#ccc;
  font-style:italic;
}

  .gba__result .name{ font-weight:700; margin:0; }
  .gba__result .desc{ margin:0; color:#ccc; }
  .gba__result .reward{ margin:0; }

  .badge{
    display:inline-block; margin-right:6px; padding:2px 6px; border-radius:8px;
    font-size:.85rem; background:#FFD700; color:#000; font-weight:bold;
  }

  .back-btn{margin:8px auto; text-align:center}
  .back-btn button{background:#444; color:#fff; padding:10px 20px; border:none; border-radius:8px; cursor:pointer}
  .back-btn button:hover{background:#666}

  /* Overlay: Bitte ins Querformat drehen (für Handy im Hochformat) */
  #rotateOverlay{
    position:fixed; inset:0; display:none; z-index:9999;
    background:rgba(0,0,0,.9); color:#FFD700;
    font-size:1.2rem; line-height:1.4; text-align:center;
    align-items:center; justify-content:center;
    padding:20px;
    box-sizing:border-box;
  }

  /* --- Mobile Feinschliff --- */
  @media (max-width: 480px){
    .gba__reels{
      grid-template-columns: repeat(2, 1fr);  /* 2×2 statt 4 in einer Reihe */
      gap:8px;
    }
    .gba{ padding:14px; }
    .reel{ padding:8px; }
  }
</style>
</head>
<body>

<div class="frame-wood">
  <div id="guellebier-automat" class="gba">
    <div class="gba__header">
      <h2>Saxonischer® Rezepte-Automatron 2000</h2>
      <p class="gba__sub">Welche Rüben müssen für das Güllebier-Rezept geerntet werden?</p>
    </div>

    <div class="gba__machine">
      <div class="gba__reels">
        <div class="reel" data-index="0"><div class="symbol"></div></div>
        <div class="reel" data-index="1"><div class="symbol"></div></div>
        <div class="reel" data-index="2"><div class="symbol"></div></div>
        <div class="reel" data-index="3"><div class="symbol"></div></div>
      </div>

      <div class="gba__action">
        <button class="gba__lever" id="gbaSpin" type="button">Knopf drücken</button>
      </div>

      <div class="gba__result" id="gbaResult"></div>
    </div>
  </div>
</div>

<!-- Zurück-Button -->
<div class="back-btn">
  <button onclick="handleBack()">Zurück</button>
</div>

<!-- Overlay für Hochformat -->
<div id="rotateOverlay">Bitte dreh dein Gerät ins Querformat</div>

<!-- Eigene Sounds -->
<audio id="sndButton" src="assets/snd/button.mp3"></audio>
<audio id="sndRattle" src="assets/snd/dreh.mp3" loop></audio>
<audio id="sndStop" src="assets/snd/anhalten.mp3"></audio>
<audio id="sndResult" src="assets/snd/ergebnis.mp3"></audio>

<script>
function log(msg){ try{ console.log('[Automat]', msg); }catch(e){} }

function handleBack(){
  try { window.close(); } catch(e) {}
  if (document.visibilityState === 'visible') {
    if (history.length > 1) { history.back(); return; }
    if (document.referrer)  { location.href = document.referrer; return; }
  }
  location.href = 'https://schlachtenbummler-verlag.jimdosite.com/neu/';
}

// Overlay-Logik (Handy: Querformat empfohlen)
function checkOrientation(){
  const ov = document.getElementById('rotateOverlay');
  if (!ov) return;
  ov.style.display = (window.innerHeight > window.innerWidth) ? 'flex' : 'none';
}

document.addEventListener('DOMContentLoaded',()=>{
  checkOrientation();
  window.addEventListener('resize', checkOrientation);
  window.addEventListener('orientationchange', checkOrientation);

  const reels = Array.from(document.querySelectorAll('.reel'));
  const btn   = document.querySelector('#gbaSpin');
  const out   = document.querySelector('#gbaResult');
  const sndButton=document.getElementById('sndButton');
  const sndRattle=document.getElementById('sndRattle');
  const sndStop=document.getElementById('sndStop');
  const sndResult=document.getElementById('sndResult');

  const COLORS = ['rot','blau','gruen','gelb'];
  const IMG = {
    rot:'assets/img/rot.png',
    blau:'assets/img/blau.png',
    gruen:'assets/img/gruen.png',
    gelb:'assets/img/gelb.png'
  };
  const SVG = {
    rot:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#2b9e45' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#d94a4a' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    blau:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#2c9aa7' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#3a7bd5' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    gruen:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#1f8a4c' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#2ecc71' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`,
    gelb:`<svg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path fill='#79b92f' d='M42 10c6 1 10 6 10 12-6-2-11-6-10-12zM37 9c-2 5-8 10-15 10 3-7 9-11 15-10z'/><path fill='#f5d142' d='M31 18c10 0 19 8 19 18S43 54 31 54 12 45 12 36s9-18 19-18z'/></svg>`
  };

  const RECIPES = {
    'rot,rot,rot,rot': {name:'Dösselheimer Güllebier',pts:15,desc:'Die braune Seele Saxoniens.'},
    'blau,blau,blau,blau': {name:'Leberknebel - Export',pts:15,desc:'Seitenstechen auch ohne Meuchelmörder.'},
    'gruen,gruen,gruen,gruen': {name:'Braune Soße',pts:15,desc:'Zähflüssig, herzhaft, löst Sorgen und Rost.'},
    'gelb,gelb,gelb,gelb': {name:'Flotter Otto - Extra Hell',pts:15,desc:'Fließt es erst heraus, bleibst du lieber gleich zuhaus!'},
    'rot,rot,rot,blau': {name:'Klemritzer Nierenquetscher',pts:12,desc:'Massiert die Organe von innen nach außen.'},
    'rot,rot,rot,gruen': {name:'Rülpsheimer Starkbier',pts:12,desc:'Schenkt Bass im Bauch.'},
    'rot,rot,rot,gelb': {name:'Lord Villains Glanzparade',pts:12,desc:'Edel und unbestechlich herb.'},
    'blau,blau,blau,rot': {name:'Donnerburger Steißtritt',pts:11,desc:'Treffsicherer Geschmack.'},
    'blau,blau,blau,gruen': {name:'Hassnitzer Kellerbräu',pts:11,desc:'Aus dem ganz dunklen Fass.'},
    'blau,blau,blau,gelb': {name:'Stinkhornsuppe - Spezial',pts:11,desc:'Duftet nach Abenteuer, Freiheit und alten Socken.'},
    'gruen,gruen,gruen,rot': {name:'Plärrener Humpentrunk',pts:10,desc:'Groß im Glas, laut im Kopf.'},
    'gruen,gruen,gruen,blau': {name:'Hassburger Urstoff Brühe',pts:10,desc:'So bekömmlich wie eine kleine Pilzvergiftung.'},
    'gruen,gruen,gruen,gelb': {name:'Dreschmarer Magenhieb',pts:10,desc:'Direkt, ehrlich, unvergesslich.'},
    'gelb,gelb,gelb,rot': {name:'Knurrwitzer Abtritt',pts:10,desc:'So männlich wie konservative Ein - Artikler.'},
    'gelb,gelb,gelb,blau': {name:'Ynnors Schnarchtrunk',pts:10,desc:'Wirkt sofort.'},
    'gelb,gelb,gelb,gruen': {name:'Schwitzwasser Abblende',pts:10,desc:'Leicht bekömmliches Dünnbier.'},
    'rot,rot,blau,blau': {name:'Beißburger Rübenhamsterwurf',pts:9,desc:'Zwei Paare, ein Ziel.'},
    'rot,rot,gruen,gruen': {name:'Ningelner Nostalgiker - Urtyp',pts:8,desc:'Schmeckt so gut wie früher, nur besser.'},
    'rot,rot,gelb,gelb': {name:'Stockheimer Knollentrunk',pts:8,desc:'Dick im Glas, jetzt mit noch mehr Fruchtfleisch.'},
    'blau,blau,gruen,gruen': {name:'Plärrener Feldschorle - Spezial',pts:8,desc:'Damit sie auch Morgen noch lauthals schreien können.'},
    'blau,blau,gelb,gelb': {name:'Grollstädter Rübensprudel - Deluxe',pts:7,desc:'Gebraut mit Liebe.'},
    'gruen,gruen,gelb,gelb': {name:'Grimmiger Krauttrunk - Extra Herb',pts:7,desc:'Kratzig im Abgang.'},
    'rot,rot,blau,gruen': {name:'Kellerleichen - Party - Mix',pts:6,desc:'Für Nächte an die man sich lieber nicht erinnert.'},
    'rot,rot,blau,gelb': {name:'Broilinger Doppelacker Sud',pts:6,desc:'Das beste aus zwei Welten.'},
    'rot,rot,gruen,gelb': {name:'Feierabend Erntetrunk',pts:6,desc:'Erfrischend wie eine 16 Stundenschicht bei Schnell & Billig.'},
    'blau,blau,rot,gruen': {name:'Zwicker Feldweg - Knöchelknacks',pts:5,desc:'Holprig und bitter.'},
    'blau,blau,rot,gelb': {name:'Ackerbowle',pts:5,desc:'Erdig-Herb'},
    'blau,blau,gruen,gelb': {name:'Lumpa Umpas goldene Brause - Edel',pts:5,desc:'Kurz aber kräftig.'},
    'gruen,gruen,rot,blau': {name:'Freudloser Hopfenrübe - Hell',pts:4,desc:'Der Spaß aus dem Glas.'},
    'gruen,gruen,rot,gelb': {name:'Ackerschorle - Export',pts:4,desc:'Das Erfrischungsgetränk für jede Arbeit.'},
    'gruen,gruen,blau,gelb': {name:'Winkelstädter Gärtnerpils',pts:4,desc:'Gereift im Biercubus.'},
    'gelb,gelb,rot,blau': {name:'Lästerhainer Jodelsprudel',pts:3,desc:'Nach zwei Schlucken singst du.'},
    'gelb,gelb,rot,gruen': {name:'Donnerburger Knollentrunk - Spezial',pts:3,desc:'Gebraut mit Blitz und Donner.'},
    'gelb,gelb,blau,gruen': {name:'Karnickelfangschlag',pts:3,desc:'Erst pelzig auf der Zunge, dann schnell im Abgang.'},
    'rot,blau,gruen,gelb': {name:'Querbeet - Klassik',pts:1,desc:'Von allem ein bisschen.'}
  };

  const RECIPES_INDEX={};
  Object.keys(RECIPES).forEach(k=>{
    RECIPES_INDEX[k.split(',').sort().join(',')] = RECIPES[k];
  });

  function normalize(combo){ return combo.slice().sort().join(','); }

  function evaluate(result){
    const key = normalize(result);
    const recipe = RECIPES_INDEX[key] || {name:'Krautwasser',pts:0,desc:'Schmeckt nach nix.'};

    out.innerHTML = `
      <div class="name">${recipe.name}</div>
      <div class="desc">${recipe.desc || ''}</div>
      <div class="reward">
        <span class="badge">+${recipe.pts} Thaler</span> für den Rübensammler, welcher den Auftrag als erstes erfüllt!
      </div>
    `;

    try { sndResult.currentTime = 0; sndResult.play(); } catch(e){}
  }

  function randomColor(){ 
    return COLORS[Math.floor(Math.random()*COLORS.length)]; 
  }

  function setSymbol(reelEl,color){
    const sym = reelEl.querySelector('.symbol');
    sym.className = 'symbol ' + color;
    const img = new Image();
    img.decoding = 'async';
    img.alt = color + 'e Rübe';
    img.onload = ()=>{ sym.innerHTML=''; sym.appendChild(img); };
    img.onerror = ()=>{ sym.innerHTML = SVG[color]; };
    img.src = IMG[color];
  }

  // Startanzeige
  reels.forEach(reel => setSymbol(reel, randomColor()));

  function spin(){
  btn.disabled = true;
  out.classList.add("loading");   // Ladezustand aktivieren
  out.innerHTML = `<div>…suche Rezept für den Ernteauftrag…</div>`;
  
  try{ sndButton.currentTime=0; sndButton.play(); }catch(e){}
  try{ sndRattle.currentTime=0; sndRattle.play(); }catch(e){}

  const finals = [];
  reels.forEach((reel,i)=>{
    const t = setInterval(()=> setSymbol(reel, randomColor()), 150);
    setTimeout(()=>{
      clearInterval(t);
      const c = randomColor();
      setSymbol(reel, c);
      finals[i] = c;
      try{ sndStop.currentTime=0; sndStop.play(); }catch(e){}

      if(i === reels.length-1){
        try{ sndRattle.pause(); }catch(e){}
        btn.disabled = false;
        out.classList.remove("loading");  // wieder normal
        evaluate(finals);
      }
    }, 1200 + i*800);
  });
}


  if(btn){ btn.addEventListener('click', spin); }
});
</script>
</body>
</html>
